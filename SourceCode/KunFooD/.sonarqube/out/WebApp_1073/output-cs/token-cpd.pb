¯

qC:\Users\Turcu Nicusor\Desktop\Work\Anul 3\DotNet\KunFooD\SourceCode\KunFooD\WebApp\Controllers\HomeController.cs
	namespace 	
WebApp
 
. 
Controllers 
{ 
[ #
DefaultControllerFilter 
] 
public		 

class		 
HomeController		 
:		  !

Controller		" ,
{

 
public 
IActionResult 
Index "
(" #
)# $
{ 	
ViewBag 
. 
LoggedIn 
= 
false $
;$ %
return 
View 
( 
) 
; 
} 	
[ 	
HttpGet	 
] 
[ 	
Route	 
( 
$str 
) 
] 
public 
IActionResult 
Error "
(" #
)# $
{ 	
return 
View 
( 
new 
ErrorViewModel *
{+ ,
	RequestId- 6
=7 8
Activity9 A
.A B
CurrentB I
?I J
.J K
IdK M
??N P
HttpContextQ \
.\ ]
TraceIdentifier] l
}m n
)n o
;o p
} 	
} 
} ã
rC:\Users\Turcu Nicusor\Desktop\Work\Anul 3\DotNet\KunFooD\SourceCode\KunFooD\WebApp\Controllers\LoginController.cs
	namespace

 	
WebApp


 
.

 
Controllers

 
{ 
[ 
Route 

(
 
$str 
) 
] 
[ #
DefaultControllerFilter 
] 
public 

class 
LoginController  
:! "

Controller# -
{ 
private 
readonly 
IUsersRepository )
_repository* 5
;5 6
public 
LoginController 
( 
IUsersRepository /

repository0 :
): ;
{ 	
_repository 
= 

repository $
;$ %
} 	
[ 	
HttpGet	 
] 
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
HttpPost	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
Login) .
(. /
[/ 0
FromBody0 8
]8 9
Login: ?
newLogin@ H
)H I
{ 	
User   
user   
=   
await   
_repository   )
.  ) *

GetByEmail  * 4
(  4 5
newLogin  5 =
.  = >
Email  > C
)  C D
;  D E
if!! 
(!! 
user!! 
!=!! 
null!! 
)!! 
{"" 
var## 
token## 
=## 
JwtToken## $
.##$ %
GenerateToken##% 2
(##2 3
user##3 7
)##7 8
;##8 9
return$$ 
Ok$$ 
($$ 
new$$ 
{%% 
token&& 
=&& 
new&& #
JwtSecurityTokenHandler&&  7
(&&7 8
)&&8 9
.&&9 :

WriteToken&&: D
(&&D E
token&&E J
)&&J K
}'' 
)'' 
;'' 
}(( 
return)) 
Unauthorized)) 
())  
)))  !
;))! "
}** 	
}++ 
},, ñ
uC:\Users\Turcu Nicusor\Desktop\Work\Anul 3\DotNet\KunFooD\SourceCode\KunFooD\WebApp\Controllers\RegisterController.cs
	namespace 	
WebApp
 
. 
Controllers 
{ 
[		 
Route		 

(		
 
$str		 
)		 
]		 
[

 #
DefaultControllerFilter

 
]

 
public 

class 
RegisterController #
:$ %

Controller& 0
{ 
private 
readonly 
IUsersRepository )
_repository* 5
;5 6
public 
RegisterController !
(! "
IUsersRepository" 2

repository3 =
)= >
{ 	
_repository 
= 

repository $
;$ %
} 	
[ 	
HttpGet	 
] 
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
HttpPost	 
] 
public 
IActionResult 
Register %
(% &
[& '
FromBody' /
]/ 0
Register1 9
newUser: A
)A B
{ 	
User 
user 
= 
Data 
. 
Domain #
.# $
Entities$ ,
., -
User- 1
.1 2
Create2 8
(8 9
newUser9 @
.@ A
UserNameA I
,I J
falseK P
,P Q
newUserR Y
.Y Z
EmailZ _
,_ `
newUsera h
.h i
Passwordi q
,q r
nulls w
,w x
nully }
)} ~
;~ 
_repository 
. 
Add 
( 
user  
)  !
;! "
return 
Ok 
( 
user 
) 
; 
}   	
}!! 
}"" È3
rC:\Users\Turcu Nicusor\Desktop\Work\Anul 3\DotNet\KunFooD\SourceCode\KunFooD\WebApp\Controllers\UsersController.cs
	namespace		 	
WebApp		
 
.		 
Controllers		 
{

 
[ 
Route 

(
 
$str 
) 
] 
[ #
DefaultControllerFilter 
] 
public 

class 
UsersController  
:! "

Controller# -
{ 
private 
readonly 
IUsersRepository )
_repository* 5
;5 6
public 
UsersController 
( 
IUsersRepository /

repository0 :
): ;
{ 	
_repository 
= 

repository $
;$ %
} 	
[ 	
HttpGet	 
] 
[ 	
Route	 
( 
$str 
) 
] 
public 
async 
Task 
< 
IActionResult '
>' (
Index) .
(. /
)/ 0
{ 	
return 
Ok 
( 
await 
_repository '
.' (
GetAll( .
(. /
)/ 0
)0 1
;1 2
} 	
[ 	
HttpGet	 
] 
[ 	
Route	 
( 
$str 
) 
] 
public 
IActionResult 
	GetAdmins &
(& '
)' (
{   	
return!! 
Ok!! 
(!! 
_repository!! !
.!!! "
	GetAdmins!!" +
(!!+ ,
)!!, -
)!!- .
;!!. /
}"" 	
[$$ 	
HttpGet$$	 
]$$ 
[%% 	
Route%%	 
(%% 
$str%% 
)%% 
]%% 
public&& 
async&& 
Task&& 
<&& 
IActionResult&& '
>&&' (
GetById&&) 0
(&&0 1
Guid&&1 5
id&&6 8
)&&8 9
{'' 	
var(( 
user(( 
=(( 
await(( 
_repository(( (
.((( )
FindById(() 1
(((1 2
id((2 4
)((4 5
;((5 6
if)) 
()) 
user)) 
==)) 
null)) 
))) 
{** 
return++ 
NotFound++ 
(++  
)++  !
;++! "
},, 
return-- 
Ok-- 
(-- 
user-- 
)-- 
;-- 
}.. 	
[00 	
HttpPost00	 
]00 
public11 
IActionResult11 
Create11 #
(11# $
[11$ %
FromBody11% -
]11- .
CreateUsers11/ :
usrToCreate11; F
)11F G
{22 	
User33 
user33 
=33 
Data33 
.33 
Domain33 #
.33# $
Entities33$ ,
.33, -
User33- 1
.331 2
Create332 8
(338 9
usrToCreate339 D
.33D E
Name33E I
,33I J
usrToCreate33K V
.33V W
IsAdmin33W ^
,33^ _
usrToCreate33` k
.33k l
Email33l q
,33q r
usrToCreate33s ~
.33~ 
Password	33 á
,
33á à
usrToCreate
33â î
.
33î ï
Token
33ï ö
,
33ö õ
usrToCreate
33ú ß
.
33ß ®
Description
33® ≥
)
33≥ ¥
;
33¥ µ
_repository44 
.44 
Add44 
(44 
user44  
)44  !
;44! "
return55 
Ok55 
(55 
user55 
)55 
;55 
}66 	
[88 	
HttpPut88	 
]88 
[99 	
Route99	 
(99 
$str99 
)99 
]99 
public:: 
async:: 
Task:: 
<:: 
IActionResult:: '
>::' (
Update::) /
(::/ 0
Guid::0 4
id::5 7
,::7 8
[::9 :
FromBody::: B
]::B C
UpdateUsers::C N
userToUpdate::O [
)::[ \
{;; 	
if<< 
(<< 
id<< 
!=<< 
userToUpdate<< "
.<<" #
Id<<# %
)<<% &
{== 
return>> 
NotFound>> 
(>>  
)>>  !
;>>! "
}?? 
var@@ 
user@@ 
=@@ 
await@@ 
_repository@@ (
.@@( )
FindById@@) 1
(@@1 2
id@@2 4
)@@4 5
;@@5 6
userAA 
.AA 
UpdateAA 
(AA 
userToUpdateAA $
.AA$ %
NameAA% )
,AA) *
userToUpdateAA+ 7
.AA7 8
IsAdminAA8 ?
,AA? @
userToUpdateAAA M
.AAM N
EmailAAN S
,AAS T
userToUpdateAAU a
.AAa b
PasswordAAb j
,AAj k
userToUpdateAAl x
.AAx y
TokenAAy ~
,AA~ 
userToUpdate
AAÄ å
.
AAå ç
Description
AAç ò
)
AAò ô
;
AAô ö
awaitBB 
_repositoryBB 
.BB 
EditBB "
(BB" #
userBB# '
)BB' (
;BB( )
returnCC 
OkCC 
(CC 
userCC 
)CC 
;CC 
}DD 	
[FF 	

HttpDeleteFF	 
]FF 
publicGG 
asyncGG 
TaskGG 
<GG 
IActionResultGG '
>GG' (
DeleteGG) /
(GG/ 0
GuidGG0 4
idGG5 7
)GG7 8
{HH 	
varII 
userII 
=II 
awaitII 
_repositoryII (
.II( )
FindByIdII) 1
(II1 2
idII2 4
)II4 5
;II5 6
ifJJ 
(JJ 
userJJ 
==JJ 
nullJJ 
)JJ 
{KK 
returnLL 
NotFoundLL 
(LL  
idLL  "
)LL" #
;LL# $
}MM 
awaitNN 
_repositoryNN 
.NN 
DeleteNN $
(NN$ %
idNN% '
)NN' (
;NN( )
returnOO 
OkOO 
(OO 
userOO 
)OO 
;OO 
}PP 	
}QQ 
}RR Ã
zC:\Users\Turcu Nicusor\Desktop\Work\Anul 3\DotNet\KunFooD\SourceCode\KunFooD\WebApp\DTOs Validator\CreateUsersValidator.cs
	namespace 	
WebApp
 
. 
DTOs_Validator 
{ 
public 

class  
CreateUsersValidator %
:& '
AbstractValidator( 9
<9 :
CreateUsers: E
>E F
{ 
public  
CreateUsersValidator #
(# $
)$ %
{		 	
RuleFor

 
(

 
users

 
=>

 
users

 "
.

" #
Name

# '
)

' (
.

( )
NotEmpty

) 1
(

1 2
)

2 3
;

3 4
RuleFor 
( 
users 
=> 
users "
." #
IsAdmin# *
)* +
.+ ,
NotEmpty, 4
(4 5
)5 6
;6 7
RuleFor 
( 
users 
=> 
users "
." #
Email# (
)( )
.) *
EmailAddress* 6
(6 7
)7 8
.8 9
NotEmpty9 A
(A B
)B C
;C D
RuleFor 
( 
users 
=> 
users "
." #
Password# +
)+ ,
., -
Length- 3
(3 4
$num4 5
,5 6
$num7 9
)9 :
;: ;
RuleFor 
( 
users 
=> 
users "
." #
Token# (
)( )
.) *
NotEmpty* 2
(2 3
)3 4
;4 5
RuleFor 
( 
users 
=> 
users "
." #
Description# .
). /
./ 0
NotEmpty0 8
(8 9
)9 :
.: ;
Length; A
(A B
$numB C
,C D
$numE H
)H I
;I J
} 	
} 
} Ω
tC:\Users\Turcu Nicusor\Desktop\Work\Anul 3\DotNet\KunFooD\SourceCode\KunFooD\WebApp\DTOs Validator\LoginValidator.cs
	namespace 	
WebApp
 
. 
DTOs_Validator 
{ 
public 

class 
LoginValidator 
:  !
AbstractValidator" 3
<3 4
Login4 9
>9 :
{ 
public 
LoginValidator 
( 
) 
{		 	
RuleFor

 
(

 
usr

 
=>

 
usr

 
.

 
Email

 $
)

$ %
.

% &
NotEmpty

& .
(

. /
)

/ 0
.

0 1
EmailAddress

1 =
(

= >
)

> ?
;

? @
RuleFor 
( 
usr 
=> 
usr 
. 
Password '
)' (
.( )
Length) /
(/ 0
$num0 1
,1 2
$num3 5
)5 6
;6 7
} 	
} 
} ó
wC:\Users\Turcu Nicusor\Desktop\Work\Anul 3\DotNet\KunFooD\SourceCode\KunFooD\WebApp\DTOs Validator\RegisterValidator.cs
	namespace 	
WebApp
 
. 
DTOs_Validator 
{ 
public 

class 
RegisterValidator "
:# $
AbstractValidator% 6
<6 7
Register7 ?
>? @
{ 
public 
RegisterValidator  
(  !
)! "
{		 	
RuleFor

 
(

 
usr

 
=>

 
usr

 
.

 
UserName

 '
)

' (
.

( )
NotEmpty

) 1
(

1 2
)

2 3
;

3 4
RuleFor 
( 
usr 
=> 
usr 
. 
Email $
)$ %
.% &
NotEmpty& .
(. /
)/ 0
.0 1
EmailAddress1 =
(= >
)> ?
;? @
RuleFor 
( 
usr 
=> 
usr 
. 
Password '
)' (
.( )
Length) /
(/ 0
$num0 1
,1 2
$num3 5
)5 6
;6 7
RuleFor 
( 
usr 
=> 
usr 
. 
ConfirmPassword .
). /
./ 0
NotEmpty0 8
(8 9
)9 :
;: ;
RuleFor 
( 
usr 
=> 
usr 
. 
ConfirmPassword .
). /
./ 0
Equal0 5
(5 6
usr6 9
=>: <
usr= @
.@ A
PasswordA I
)I J
.J K
WithMessageK V
(V W
$strW p
)p q
;q r
} 	
} 
} …	
gC:\Users\Turcu Nicusor\Desktop\Work\Anul 3\DotNet\KunFooD\SourceCode\KunFooD\WebApp\DTOs\CreateUsers.cs
	namespace 	
WebApp
 
. 
DTOs 
{ 
public 

class 
CreateUsers 
{ 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
bool 
IsAdmin 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
public		 
string		 
Token		 
{		 
get		 !
;		! "
set		# &
;		& '
}		( )
public

 
string

 
Description

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
} 
} ‘
aC:\Users\Turcu Nicusor\Desktop\Work\Anul 3\DotNet\KunFooD\SourceCode\KunFooD\WebApp\DTOs\Login.cs
	namespace 	
WebApp
 
. 
DTOs 
{ 
public 

class 
Login 
{ 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ô
dC:\Users\Turcu Nicusor\Desktop\Work\Anul 3\DotNet\KunFooD\SourceCode\KunFooD\WebApp\DTOs\Register.cs
	namespace 	
WebApp
 
. 
DTOs 
{ 
public 

class 
Register 
{ 
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
ConfirmPassword %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
}		 
}

 ›

gC:\Users\Turcu Nicusor\Desktop\Work\Anul 3\DotNet\KunFooD\SourceCode\KunFooD\WebApp\DTOs\UpdateUsers.cs
	namespace 	
WebApp
 
. 
DTOs 
{ 
public 

class 
UpdateUsers 
{ 
public 
Guid 
Id 
{ 
get 
; 
set !
;! "
}# $
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public		 
bool		 
IsAdmin		 
{		 
get		 !
;		! "
set		# &
;		& '
}		( )
public

 
string

 
Email

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Token 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
} 
} Ù
C:\Users\Turcu Nicusor\Desktop\Work\Anul 3\DotNet\KunFooD\SourceCode\KunFooD\WebApp\Filters\DefaultControllerFilterAttribute.cs
	namespace 	
WebApp
 
. 
Filters 
{ 
public 

class #
DefaultControllerFilter (
:) *!
ActionFilterAttribute+ @
{ 
public 
override 
void 
OnActionExecuting .
(. /"
ActionExecutingContext/ E
contextF M
)M N
{		 	
if

 
(

 
!

 
context

 
.

 

ModelState

 #
.

# $
IsValid

$ +
)

+ ,
{ 
context 
. 
Result 
=  
new! $"
BadRequestObjectResult% ;
(; <
context< C
.C D

ModelStateD N
)N O
;O P
} 
} 	
} 
} ¥
lC:\Users\Turcu Nicusor\Desktop\Work\Anul 3\DotNet\KunFooD\SourceCode\KunFooD\WebApp\Models\ErrorViewModel.cs
	namespace 	
WebApp
 
. 
Models 
{ 
public 

class 
ErrorViewModel 
{ 
public 
string 
	RequestId 
{  !
get" %
;% &
set' *
;* +
}, -
public 
bool 
ShowRequestId !
=>" $
!% &
string& ,
., -
IsNullOrEmpty- :
(: ;
	RequestId; D
)D E
;E F
} 
}		 œ	
^C:\Users\Turcu Nicusor\Desktop\Work\Anul 3\DotNet\KunFooD\SourceCode\KunFooD\WebApp\Program.cs
	namespace 	
WebApp
 
{ 
public 

class 
Program 
{ 
	protected 
Program 
( 
) 
{		 	
}

 	
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
BuildWebHost 
( 
args 
) 
. 
Run "
(" #
)# $
;$ %
} 	
public 
static 
IWebHost 
BuildWebHost +
(+ ,
string, 2
[2 3
]3 4
args5 9
)9 :
=>; =
WebHost 
.  
CreateDefaultBuilder (
(( )
args) -
)- .
. 

UseStartup 
< 
Startup #
># $
($ %
)% &
. 
Build 
( 
) 
; 
} 
} ü
hC:\Users\Turcu Nicusor\Desktop\Work\Anul 3\DotNet\KunFooD\SourceCode\KunFooD\WebApp\Security\JWTToken.cs
	namespace 	
WebApp
 
. 
Security 
{ 
public		 

static		 
class		 
JwtToken		  
{

 
private 
const 
string 
Secret #
=$ %
$str	& Ä
;
Ä Å
public 
static 
SecurityToken #
GenerateToken$ 1
(1 2
User2 6
user7 ;
,; <
int= @
expireMinutesA N
=O P
$numQ S
)S T
{ 	
var 
symmetricKey 
= 
Convert &
.& '
FromBase64String' 7
(7 8
Secret8 >
)> ?
;? @
var 
tokenHandler 
= 
new "#
JwtSecurityTokenHandler# :
(: ;
); <
;< =
var 
now 
= 
DateTime 
. 
UtcNow %
;% &
var 
tokenDescriptor 
=  !
new" %#
SecurityTokenDescriptor& =
{ 
Subject 
= 
new 
ClaimsIdentity ,
(, -
new- 0
[0 1
]1 2
{ 
new 
Claim 
( 

ClaimTypes (
.( )
Name) -
,- .
user/ 3
.3 4
UserName4 <
)< =
,= >
new 
Claim 
( 

ClaimTypes (
.( )
Name) -
,- .
user/ 3
.3 4
Email4 9
)9 :
,: ;
} 
) 
, 
Expires 
= 
now 
. 

AddMinutes (
(( )
Convert) 0
.0 1
ToInt321 8
(8 9
expireMinutes9 F
)F G
)G H
,H I
SigningCredentials "
=# $
new% (
SigningCredentials) ;
(; <
new< ? 
SymmetricSecurityKey@ T
(T U
symmetricKeyU a
)a b
,b c
SecurityAlgorithmsd v
.v w 
HmacSha256Signature	w ä
)
ä ã
} 
; 
return 
tokenHandler 
.  
CreateToken  +
(+ ,
tokenDescriptor, ;
); <
;< =
}   	
}!! 
}"" ≤#
^C:\Users\Turcu Nicusor\Desktop\Work\Anul 3\DotNet\KunFooD\SourceCode\KunFooD\WebApp\Startup.cs
	namespace 	
WebApp
 
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
services 
. 
AddTransient !
<! "
IDatabaseContext" 2
,2 3
DatabaseContext4 C
>C D
(D E
)E F
;F G
services 
. 
AddTransient !
<! "
IUsersRepository" 2
,2 3
UsersRepository4 C
>C D
(D E
)E F
;F G
services 
. 
AddDbContext !
<! "
DatabaseContext" 1
>1 2
(2 3
options3 :
=>; =
options> E
.E F
UseSqlServerF R
(R S
ConfigurationS `
.` a
GetConnectionStringa t
(t u
$str	u à
)
à â
)
â ä
)
ä ã
;
ã å
services 
. 
AddMvc 
( 
options #
=>$ &
{   
options!! 
.!! 
Filters!! #
.!!# $
Add!!$ '
(!!' (
typeof!!( .
(!!. /#
DefaultControllerFilter!!/ F
)!!F G
)!!G H
;!!H I
}"" 
)## 
.## 
AddFluentValidation## !
(##! "
fvc##" %
=>##& (
fvc##) ,
.##, -4
(RegisterValidatorsFromAssemblyContaining##- U
<##U V
Startup##V ]
>##] ^
(##^ _
)##_ `
)##` a
;##a b
services%% 
.%% 
AddSwaggerGen%% "
(%%" #
c%%# $
=>%%% '
{&& 
c'' 
.'' 

SwaggerDoc'' 
('' 
$str'' !
,''! "
new''# &
Info''' +
{'', -
Title''. 3
=''4 5
$str''6 C
,''C D
Version''E L
=''M N
$str''O S
}''T U
)''U V
;''V W
}(( 
)(( 
;(( 
})) 	
public,, 
void,, 
	Configure,, 
(,, 
IApplicationBuilder,, 1
app,,2 5
,,,5 6
IHostingEnvironment,,7 J
env,,K N
),,N O
{-- 	
app// 
.// 

UseSwagger// 
(// 
)// 
;// 
app22 
.22 
UseSwaggerUI22 
(22 
c22 
=>22 !
{33 
c44 
.44 
SwaggerEndpoint44 !
(44! "
$str44" <
,44< =
$str44> J
)44J K
;44K L
}55 
)55 
;55 
if77 
(77 
env77 
.77 
IsDevelopment77 !
(77! "
)77" #
)77# $
{88 
app99 
.99 %
UseDeveloperExceptionPage99 -
(99- .
)99. /
;99/ 0
app:: 
.:: 
UseBrowserLink:: "
(::" #
)::# $
;::$ %
};; 
else<< 
{== 
app>> 
.>> 
UseExceptionHandler>> '
(>>' (
$str>>( 5
)>>5 6
;>>6 7
}?? 
appAA 
.AA 
UseStaticFilesAA 
(AA 
)AA  
;AA  !
appCC 
.CC 
UseMvcCC 
(CC 
routesCC 
=>CC  
{DD 
routesEE 
.EE 
MapRouteEE 
(EE  
nameFF 
:FF 
$strFF #
,FF# $
templateGG 
:GG 
$strGG F
)GGF G
;GGG H
}HH 
)HH 
;HH 
}II 	
}JJ 
}KK 